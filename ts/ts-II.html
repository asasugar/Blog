<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>通俗易懂的 TS 教程（中） | 随便写写</title>
    <meta name="description" content="带着自己的影子回家的时候，才知道什么是寂寞和孤单">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="icon" href="/favicon.png">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.69e5599a.css" as="style"><link rel="preload" href="/assets/js/app.98369610.js" as="script"><link rel="preload" href="/assets/js/2.dae98aab.js" as="script"><link rel="preload" href="/assets/js/40.7007eded.js" as="script"><link rel="prefetch" href="/assets/js/10.73b3b5b2.js"><link rel="prefetch" href="/assets/js/11.2fde9270.js"><link rel="prefetch" href="/assets/js/12.c120d577.js"><link rel="prefetch" href="/assets/js/13.720b50ee.js"><link rel="prefetch" href="/assets/js/14.6ed42f92.js"><link rel="prefetch" href="/assets/js/15.7976e4a5.js"><link rel="prefetch" href="/assets/js/16.21d4807e.js"><link rel="prefetch" href="/assets/js/17.eb16f132.js"><link rel="prefetch" href="/assets/js/18.4218704f.js"><link rel="prefetch" href="/assets/js/19.65ec2817.js"><link rel="prefetch" href="/assets/js/20.40e8aa21.js"><link rel="prefetch" href="/assets/js/21.22240ee6.js"><link rel="prefetch" href="/assets/js/22.8e0d5a17.js"><link rel="prefetch" href="/assets/js/23.fba9a86f.js"><link rel="prefetch" href="/assets/js/24.458a7b0c.js"><link rel="prefetch" href="/assets/js/25.7f151f04.js"><link rel="prefetch" href="/assets/js/26.35d7689f.js"><link rel="prefetch" href="/assets/js/27.5df5b215.js"><link rel="prefetch" href="/assets/js/28.64b9c3a7.js"><link rel="prefetch" href="/assets/js/29.67682e09.js"><link rel="prefetch" href="/assets/js/3.59dfb079.js"><link rel="prefetch" href="/assets/js/30.ec3afe49.js"><link rel="prefetch" href="/assets/js/31.a9b9bd0d.js"><link rel="prefetch" href="/assets/js/32.86af9a47.js"><link rel="prefetch" href="/assets/js/33.8816d038.js"><link rel="prefetch" href="/assets/js/34.522820e5.js"><link rel="prefetch" href="/assets/js/35.189962a7.js"><link rel="prefetch" href="/assets/js/36.83f59cee.js"><link rel="prefetch" href="/assets/js/37.3827d05d.js"><link rel="prefetch" href="/assets/js/38.a945b5cc.js"><link rel="prefetch" href="/assets/js/39.8a540b3f.js"><link rel="prefetch" href="/assets/js/4.04e4c1e6.js"><link rel="prefetch" href="/assets/js/41.c3cfe1e2.js"><link rel="prefetch" href="/assets/js/42.49b178e3.js"><link rel="prefetch" href="/assets/js/43.496ab7c3.js"><link rel="prefetch" href="/assets/js/44.f793f99a.js"><link rel="prefetch" href="/assets/js/45.6b0d1bc1.js"><link rel="prefetch" href="/assets/js/46.3a61edc2.js"><link rel="prefetch" href="/assets/js/5.99243804.js"><link rel="prefetch" href="/assets/js/6.9cdf9193.js"><link rel="prefetch" href="/assets/js/7.9bcb2229.js"><link rel="prefetch" href="/assets/js/8.6633c8f2.js"><link rel="prefetch" href="/assets/js/9.9f7f6803.js">
    <link rel="stylesheet" href="/assets/css/0.styles.69e5599a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="随便写写" class="logo"> <span class="site-name can-hide">随便写写</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div> <a href="https://github.com/asasugar/Blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    My GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div> <a href="https://github.com/asasugar/Blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    My GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/array-deduplication.html" class="sidebar-link">数组去重</a></li><li><a href="/js/evenbus.html" class="sidebar-link">如何实现一个简易的 evenBus？</a></li><li><a href="/js/fn.html" class="sidebar-link">箭头函数与普通函数的区别</a></li><li><a href="/js/debounceAndthrottle.html" class="sidebar-link">防抖(debounce)与节流(throttle)</a></li><li><a href="/js/event-loop.html" class="sidebar-link">Event Loop （浏览器端）</a></li><li><a href="/js/extends.html" class="sidebar-link">js继承</a></li><li><a href="/js/handwriting-series.html" class="sidebar-link">js源码手写系列</a></li><li><a href="/js/isEqual.html" class="sidebar-link">深度对比两个值是否相等</a></li><li><a href="/js/axios.html" class="sidebar-link">axios封装（支持请求失败自动重发,缓存请求，设置缓存过期时长）</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>TS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/ts/ts-I.html" class="sidebar-link">通俗易懂的 TS 教程（上）</a></li><li><a href="/ts/ts-II.html" class="active sidebar-link">通俗易懂的 TS 教程（中）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ts/ts-II.html#ts-进阶" class="sidebar-link">TS 进阶</a></li></ul></li><li><a href="/ts/ts-III.html" class="sidebar-link">通俗易懂的 TS 教程（下）</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue/vue-plugin.html" class="sidebar-link">如何编写 Vue 插件？</a></li><li><a href="/vue/vue-render-component.html" class="sidebar-link">如何编写 Vue render 组件？</a></li><li><a href="/vue/vuex.html" class="sidebar-link">实现一个极简易的Vuex核心功能</a></li><li><a href="/vue/vue-router@4-addRoutes.html" class="sidebar-link">在vue-router@4以上的版本实现类似3版本的addRoutes</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React-Native</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rn/mobx-react.html" class="sidebar-link">如何使用 mobx-react 做rn状态管理？</a></li><li><a href="/rn/rn-eslint.html" class="sidebar-link">为rn上eslint代码检测</a></li><li><a href="/rn/rn-rename-android.html" class="sidebar-link">为rn修改包名[Android篇]</a></li><li><a href="/rn/rn-rename-ios.html" class="sidebar-link">为rn修改包名[iOS篇]</a></li><li><a href="/rn/rn-http.html" class="sidebar-link">让rn支持http请求</a></li><li><a href="/rn/rn-androidX.html" class="sidebar-link">支持AndroidX</a></li><li><a href="/rn/rn-android-64K.html" class="sidebar-link">Android App 方法超出64K解决方案，即如何启动“多 dex 文件”</a></li><li><a href="/rn/rn-set-version.html" class="sidebar-link">rn修改应用版本号</a></li><li><a href="/rn/rn-push.html" class="sidebar-link">rn安卓端多厂商推送交互</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>构建工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/buildTool/rollup.html" class="sidebar-link">如何使用 rollup 构建 js？</a></li><li><a href="/buildTool/webpack-optimizate.html" class="sidebar-link">兄 dei，是时候给你的 Webpack 做一波优化了~</a></li><li><a href="/buildTool/importmap.html" class="sidebar-link">importmap去做 Vite打包缓存“contentHash”</a></li><li><a href="/buildTool/package-json.html" class="sidebar-link">package.json解析</a></li><li><a href="/buildTool/rspack.html" class="sidebar-link">基于 Rspack 的构建能力升级实施方案</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端性能优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/performanceOptimization/lazyImage.html" class="sidebar-link">实现图片懒加载</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/other/git.html" class="sidebar-link">带你掌握 Git 命令</a></li><li><a href="/other/standard.html" class="sidebar-link">前端开发规范</a></li><li><a href="/other/ssh-key.html" class="sidebar-link">window git 生成 ssh key</a></li><li><a href="/other/pdf-down.html" class="sidebar-link">如何让浏览器下载文件（eg:PDF、图片...），而不直接打开？</a></li><li><a href="/other/git-commit.html" class="sidebar-link">规范git提交利器指南</a></li><li><a href="/other/vuepress-blog.html" class="sidebar-link">vuepress 搭建你的个人博客</a></li><li><a href="/other/h5.html" class="sidebar-link">移动端H5填坑</a></li><li><a href="/other/skyline.html" class="sidebar-link">小程序skyline渲染引擎迁移</a></li><li><a href="/other/patch-package.html" class="sidebar-link">除了PR以外，如何优雅地解决npm依赖 bug</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="通俗易懂的-ts-教程（中）"><a href="#通俗易懂的-ts-教程（中）" class="header-anchor">#</a> 通俗易懂的 TS 教程（中）</h1> <h2 id="ts-进阶"><a href="#ts-进阶" class="header-anchor">#</a> TS 进阶</h2> <p>这一部分的内容就需要费点脑细胞了，毕竟学习一门语言，还是没那么容易的，最好把基础的内容都理解透彻之后再来学进阶。</p> <h3 id="高级类型（一）"><a href="#高级类型（一）" class="header-anchor">#</a> 高级类型（一）</h3> <p>高级类型分一和二两部分，一的部分不需要理解泛型也能理解，二的部分需要理解泛型之后才能理解，所以二被拆分到后面去了。</p> <blockquote><p>联合类型</p></blockquote> <p>如果希望一个变量可以支持多种类型，就可以用联合类型（union types）<code>|</code> 来定义。</p> <p>例如，一个变量既支持 number 类型，又支持 string 类型，就可以这么写：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">let</span> num<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

num <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
num <span class="token operator">=</span> <span class="token string">'eight'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>联合类型大大提高了类型的可扩展性，但当 <code>TS</code> 不确定一个联合类型的变量到底是哪个类型的时候，只能访问他们共有的属性和方法。</p> <p>比如这里就只能访问 <code>number</code> 类型和 <code>string</code> 类型共有的方法，如下图，</p> <p><img src="https://raw.githubusercontent.com/asasugar/pic-bed/master/imgs/20220328155259.png" alt="20220328155259"></p> <p>如果直接访问 <code>length</code> 属性，<code>string</code> 类型上有，<code>number</code> 类型上没有，就报错了，</p> <p><img src="https://raw.githubusercontent.com/asasugar/pic-bed/master/imgs/20220328155347.png" alt="20220328155347"></p> <blockquote><p>交叉类型</p></blockquote> <p>如果要对对象形状进行扩展，可以使用交叉类型 <code>&amp;</code>。</p> <p>比如 Person 有 name 和 age 的属性，而 Student 在 name 和 age 的基础上还有 grade 属性，就可以这么写，</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">Student</span> <span class="token operator">=</span> Person <span class="token operator">&amp;</span> <span class="token punctuation">{</span> grade<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这和类的<code>继承</code>是一模一样的，这样 <code>Student</code> 就继承了 <code>Person</code> 上的属性，</p> <blockquote><p>类型别名（type）</p></blockquote> <p>类型别名（type aliase），听名字就很好理解，就是给类型起个别名。</p> <p>就像我们项目中配置 <code>alias</code>，不用写相对路径就能很方便地引入文件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> componentA <span class="token keyword">from</span> <span class="token string">'../../../../components/componentA/index.vue'</span><span class="token punctuation">;</span>
<span class="token comment">// 变成</span>
<span class="token keyword">import</span> componentA <span class="token keyword">from</span> <span class="token string">'@/components/componentA/index.vue'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>类型别名用 <code>type</code> 关键字来书写，有了类型别名，我们书写 <code>TS</code> 的时候可以更加方便简洁。</p> <p>比如下面这个例子，<code>getName</code> 这个函数接收的参数可能是字符串，可能是函数，就可以这么写。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">Name</span> <span class="token operator">=</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">NameResolver</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">NameOrResolver</span> <span class="token operator">=</span> Name <span class="token operator">|</span> NameResolver<span class="token punctuation">;</span> <span class="token comment">// 联合类型</span>
<span class="token keyword">function</span> <span class="token function">getName</span><span class="token punctuation">(</span>n<span class="token operator">:</span> NameOrResolver<span class="token punctuation">)</span><span class="token operator">:</span> Name <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> n <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> n<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">n</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>这样调用时传字符串和函数都可以</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token function">getName</span><span class="token punctuation">(</span><span class="token string">'Sugar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">'Sugar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>类型别名会给一个类型起个新名字。类型别名有时和接口很像，但是可以作用于原始值，联合类型，元组以及其它任何你需要手写的类型。-- TS 文档</p> <p>类型别名的用法如下:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">Name</span> <span class="token operator">=</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// 基本类型</span>

<span class="token keyword">type</span> <span class="token class-name">arrItem</span> <span class="token operator">=</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// 联合类型</span>

<span class="token keyword">const</span> arr<span class="token operator">:</span> arrItem<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Person</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> Name<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Student</span> <span class="token operator">=</span> Person <span class="token operator">&amp;</span> <span class="token punctuation">{</span> grade<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 交叉类型</span>

<span class="token keyword">type</span> <span class="token class-name">Teacher</span> <span class="token operator">=</span> Person <span class="token operator">&amp;</span> <span class="token punctuation">{</span> major<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">StudentAndTeacherList</span> <span class="token operator">=</span> <span class="token punctuation">[</span>Student<span class="token punctuation">,</span> Teacher<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 元组类型</span>

<span class="token keyword">const</span> list<span class="token operator">:</span> StudentAndTeacherList <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Sugar'</span><span class="token punctuation">,</span> grade<span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Sugar'</span><span class="token punctuation">,</span> major<span class="token operator">:</span> <span class="token string">'Chinese'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="type-和-interface-的区别"><a href="#type-和-interface-的区别" class="header-anchor">#</a> type 和 interface 的区别</h4> <p>两者相同点：</p> <ul><li><p>都可以定义一个对象或函数</p></li> <li><p>都允许继承</p> <p><code>interface</code> 使用 <code>extends</code> 实现继承， <code>type</code> 使用 <code>交叉类型 &amp;</code> 实现继承</p></li></ul> <p>两者不同点：</p> <ul><li><p><code>interface（接口）</code> 是 <code>TS</code> 设计出来用于<code>定义对象</code>类型的，可以对对象的形状进行描述。</p></li> <li><p><code>type</code> 是类型别名，用于给各种类型定义<code>别名</code>，让 TS 写起来更简洁、清晰。</p></li> <li><p><code>type</code> 可以声明基本类型、联合类型、交叉类型、元组，<code>interface</code> 不行</p></li> <li><p>interface 可以<code>合并重复声明</code>，type 不行</p> <p>合并重复声明：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  <span class="token comment">// 重复声明 interface，就合并了</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> person<span class="token operator">:</span> Person <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'Sugar'</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>重复声明 type ，就报错了</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">Person</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Person</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// Duplicate identifier 'Person'</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> person<span class="token operator">:</span> Person <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'Sugar'</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><img src="https://raw.githubusercontent.com/asasugar/pic-bed/master/imgs/20220328161229.png" alt="20220328161229"></p></li></ul> <p>这两者的区别说了这么多，其实本不该把这两个东西拿来做对比，他们俩是完全不同的概念。</p> <p><code>interface</code> 是接口，用于描述一个对象。</p> <p><code>type</code> 是类型别名，用于给各种类型定义别名，让 <code>TS</code> 写起来更简洁、清晰。</p> <p>只是有时候两者都能实现同样的功能，才会经常被混淆</p> <p>平时开发中，一般使用 <code>组合</code> 或者 <code>交叉类型</code> 的时候，用 <code>type</code>。</p> <p>一般要用类的 <code>extends</code> 或 <code>implements</code> 时，用 <code>interface</code>。</p> <p>其他情况，比如定义一个 <code>对象</code> 或者 <code>函数</code> ，就看你心情了。</p> <blockquote><p>类型保护</p></blockquote> <p>如果有一个 <code>getLength</code> 函数，入参是联合类型 <code>number | string</code>，返回入参的 <code>length</code>，</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">getLength</span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> arg<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>从上文可知，这么写会报错，因为 number 类型上没有 length 属性。</p> <p><img src="https://raw.githubusercontent.com/asasugar/pic-bed/master/imgs/20220328161627.png" alt="20220328161627"></p> <p>这个时候，类型保护（Type Guards）出现了，可以使用 <code>typeof</code> 关键字判断变量的类型。</p> <p>我们把 <code>getLength</code> 方法改造一下，就可以精准地获取到 <code>string</code> 类型的 <code>length</code> 属性了，</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">getLength</span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> arg <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> arg<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> arg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>之所以叫类型保护，就是为了能够在不同的分支条件中缩小范围，这样我们代码出错的几率就大大降低了。</p> <blockquote><p>类型断言</p></blockquote> <p>上文的例子也可以使用类型断言 <code>as</code> 来解决。</p> <p>使用类型断言来告诉 TS，我（开发者）比你（编译器）更清楚这个参数是什么类型，你就别给我报错了，</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">getLength</span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> str <span class="token operator">=</span> arg <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>str<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> str<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token builtin">number</span> <span class="token operator">=</span> arg <span class="token keyword">as</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token builtin">number</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong><em>注意，类型断言不是类型转换，把一个类型断言成联合类型中不存在的类型会报错。</em></strong></p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">getLength</span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>arg <span class="token keyword">as</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="https://raw.githubusercontent.com/asasugar/pic-bed/master/imgs/20220328162441.png" alt="20220328162441"></p> <blockquote><p>字面量类型</p></blockquote> <p>有时候，我们需要定义一些常量，就需要用到字面量类型，比如，</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">ButtonSize</span> <span class="token operator">=</span> <span class="token string">'mini'</span> <span class="token operator">|</span> <span class="token string">'small'</span> <span class="token operator">|</span> <span class="token string">'normal'</span> <span class="token operator">|</span> <span class="token string">'large'</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Sex</span> <span class="token operator">=</span> <span class="token string">'男'</span> <span class="token operator">|</span> <span class="token string">'女'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这样就只能从这些定义的常量中取值，乱取值会报错，</p> <p><img src="https://raw.githubusercontent.com/asasugar/pic-bed/master/imgs/20220328162630.png" alt="20220328162630"></p> <h3 id="泛型"><a href="#泛型" class="header-anchor">#</a> 泛型</h3> <p>泛型，是 TS 比较难理解的部分，拿下了泛型，对 TS 的理解就又上了一个台阶，对后续深入学习帮助很大。</p> <blockquote><p>为什么需要泛型？</p></blockquote> <p>如果你看过 TS 文档，一定看过这样两段话：</p> <blockquote><p>软件工程中，我们不仅要创建一致的定义良好的 API，同时也要考虑可重用性。组件不仅能够支持当前的数据类型，同时也能支持未来的数据类型，这在创建大型系统时为你提供了十分灵活的功能。</p></blockquote> <blockquote><p><em>在像 C# 和 Java 这样的语言中，可以使用泛型来创建可重用的组件，一个组件可以支持多种类型的数据。这样用户就可以以自己的数据类型来使用组件。</em></p></blockquote> <p>我觉得初学者应该要先明白为什么需要泛型这个东西，它解决了什么问题？而不是看这种拗口的定义。</p> <p>我们还是先来看这样一个例子，体会一下泛型解决的问题吧。</p> <p>定义一个 <code>print</code> 函数，这个函数的功能是把传入的参数打印出来，再返回这个参数，传入参数的类型是 <code>string</code>，函数返回类型为 <code>string</code>。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">print</span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> arg<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>现在需求变了，我还需要打印 <code>number</code> 类型，怎么办？</p> <p>可以使用联合类型来改造：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">print</span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> arg<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>现在需求又变了，我还需要打印 string 数组、number 数组，甚至任何类型，怎么办？</p> <p>有个笨方法，支持多少类型就写多少联合类型。</p> <p>或者把参数类型改成 <code>any</code>。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">print</span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> arg<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>且不说写 <code>any</code> 类型不好，毕竟在 <code>TS</code> 中尽量不要写 <code>any</code>。</p> <p>而且这也不是我们想要的结果，只能说传入的值是 any 类型，输出的值是 any 类型，传入和返回并不是统一的。</p> <p>这么写甚至还会出现 bug：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> res<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>定义 <code>string</code> 类型来接收 <code>print</code> 函数的返回值，返回的是个 <code>number</code> 类型，TS 并不会报错提示我们。</p> <p>这个时候，泛型就出现了，它可以轻松解决输入输出要一致的问题。</p> <p><strong><em>注意：泛型不是为了解决这一个问题设计出来的，泛型还解决了很多其他问题，这里是通过这个例子来引出泛型。</em></strong></p> <blockquote><p>泛型基本使用</p></blockquote> <h4 id="处理函数参数"><a href="#处理函数参数" class="header-anchor">#</a> 处理函数参数</h4> <p>泛型的语法是 <code>&lt;&gt;</code> 里写类型参数，一般可以用 <code>T</code> 来表示。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">print</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> arg<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这样，我们就做到了输入和输出的类型统一，且可以输入输出任何类型。</p> <p>如果类型不统一，就会报错：</p> <p><img src="https://raw.githubusercontent.com/asasugar/pic-bed/master/imgs/20220328163948.png" alt="20220328163948"></p> <p>泛型中的 <code>T</code> 就像一个 <code>占位符</code> 、或者说一个 <code>变量</code> ，在使用的时候可以把定义的类型像参数一样传入，它可以原封不动地输出。</p> <p>我们在使用的时候可以有两种方式指定类型。</p> <ul><li>定义要使用的类型</li> <li>TS 类型推断，自动推导出类型</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token generic-function"><span class="token function">print</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 定义 T 为 string</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TS 类型推断，自动推导类型为 string</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>我们知道，<code>type</code> 和 <code>interface</code> 都可以定义函数类型，也用泛型来写一下，</p> <p>type 这么写：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">Print</span> <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">T</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> printFn<span class="token operator">:</span> <span class="token function-variable function">Print</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">print</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> arg<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>interface 这么写：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">Iprint<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">printFn</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">print</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> arg<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> myPrint<span class="token operator">:</span> Iprint<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span> <span class="token operator">=</span> printFn<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="默认参数"><a href="#默认参数" class="header-anchor">#</a> 默认参数</h4> <p>如果要给泛型加默认参数，可以这么写：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">Iprint<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">number</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">print</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> arg<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> myPrint<span class="token operator">:</span> Iprint <span class="token operator">=</span> print<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>这样默认就是 <code>number</code> 类型了，怎么样，是不是感觉 <code>T</code> 就如同函数参数一样呢？</p> <h4 id="处理多个函数参数"><a href="#处理多个函数参数" class="header-anchor">#</a> 处理多个函数参数</h4> <p>现在有这么一个函数，传入一个只有两项的元组，交换元组的第 0 项和第 1 项，返回这个元组。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">swap</span><span class="token punctuation">(</span>tuple<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>tuple<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tuple<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这么写，我们就丧失了类型，用泛型来改造一下。</p> <p>我们用 T 代表第 0 项的类型，用 U 代表第 1 项的类型。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">swap</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>tuple<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token constant">U</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>tuple<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tuple<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这样就可以实现了元组第 0 项和第 1 项类型的控制。</p> <p><img src="https://raw.githubusercontent.com/asasugar/pic-bed/master/imgs/20220328170628.png" alt="20220328170628"></p> <h4 id="函数副作用操作"><a href="#函数副作用操作" class="header-anchor">#</a> 函数副作用操作</h4> <p>泛型不仅可以很方便地约束函数的参数类型，还可以用在函数执行副作用操作的时候。</p> <p>比如我们有一个通用的异步请求方法，想根据不同的 url 请求返回不同类型的数据。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">request</span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>调一个获取用户信息的接口：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'user/info'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这时候的返回结果 res 就是一个 any 类型，非常讨厌。</p> <p><img src="https://raw.githubusercontent.com/asasugar/pic-bed/master/imgs/20220328171040.png" alt="20220328171040"></p> <p>我们希望调用 API 都清晰的知道返回类型是什么数据结构，就可以这么做：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">request</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">UserInfo</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token generic-function"><span class="token function">request</span><span class="token generic class-name"><span class="token operator">&lt;</span>UserInfo<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'user/info'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>这样就能很舒服地拿到接口返回的数据类型，开发效率大大提高：</p> <p><img src="https://raw.githubusercontent.com/asasugar/pic-bed/master/imgs/20220328171236.png" alt="20220328171236"></p> <blockquote><p>约束泛型</p></blockquote> <p>假设现在有这么一个函数，打印传入参数的长度，我们这么写：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">printLength</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> arg<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>因为不确定 T 是否有 length 属性，会报错：</p> <p><img src="https://raw.githubusercontent.com/asasugar/pic-bed/master/imgs/20220328171611.png" alt="20220328171611"></p> <p>那么现在我想约束这个泛型，一定要有 length 属性，怎么办？</p> <p>可以和 <code>interface</code> 结合，来约束类型。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">ILength</span> <span class="token punctuation">{</span>
  length<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">printLength</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> ILength<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> arg<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这其中的关键就是 <code>&lt;T extends ILength&gt;</code>，让这个泛型继承接口 <code>ILength</code>，这样就能约束泛型。</p> <p>我们定义的变量一定要有 length 属性，比如下面的 str、arr 和 obj，才可以通过 TS 编译。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token function">printLength</span><span class="token punctuation">(</span><span class="token string">'Sugar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token function">printLength</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">printLength</span><span class="token punctuation">(</span><span class="token punctuation">{</span> length<span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这个例子也再次印证了 <code>interface</code> 的 <code>duck typing</code>。</p> <p>只要你有 <code>length</code> 属性，都符合约束，那就不管你是 str，arr 还是 obj，都没问题。</p> <p>当然，我们定义一个不包含 length 属性的变量，比如数字，就会报错：</p> <p><img src="https://raw.githubusercontent.com/asasugar/pic-bed/master/imgs/20220328172009.png" alt="20220328172009"></p> <blockquote><p>泛型的一些应用</p></blockquote> <p>使用泛型，可以在定义函数、接口或类的时候，不预先指定具体类型，而是在使用的时候再指定类型。</p> <h4 id="泛型约束类"><a href="#泛型约束类" class="header-anchor">#</a> 泛型约束类</h4> <p>定义一个栈，有入栈和出栈两个方法，如果想入栈和出栈的元素类型统一，就可以这么写：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">Stack<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> data<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">push</span><span class="token punctuation">(</span>item<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>在定义实例的时候写类型，比如，入栈和出栈都要是 number 类型，就这么写：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stack<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这样，入栈一个字符串就会报错：</p> <p><img src="https://raw.githubusercontent.com/asasugar/pic-bed/master/imgs/20220328172709.png" alt="20220328172709"></p> <p>特别注意的是，泛型无法约束类的静态成员。</p> <p>给 <code>pop</code> 方法定义 <code>static</code> 关键字，就报错了</p> <p><img src="https://raw.githubusercontent.com/asasugar/pic-bed/master/imgs/20220328172832.png" alt="20220328172832"></p> <h4 id="泛型约束接口"><a href="#泛型约束接口" class="header-anchor">#</a> 泛型约束接口</h4> <p>使用泛型，也可以对 <code>interface</code> 进行改造，让 interface 更灵活。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">IKeyValue<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
  key<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
  value<span class="token operator">:</span> <span class="token constant">U</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> k1<span class="token operator">:</span> IKeyValue<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">'Sugar'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> k2<span class="token operator">:</span> IKeyValue<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">'Sugar'</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">24</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="泛型定义数组"><a href="#泛型定义数组" class="header-anchor">#</a> 泛型定义数组</h4> <p>定义一个数组，我们之前是这么写的：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> arr<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>现在这么写也可以：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> arr<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>小结
<code>泛型</code>（Generics），从字面上理解，泛型就是一般的，广泛的。</p></blockquote> <p>泛型是指在定义函数、接口或类的时候，不预先指定具体类型，而是在使用的时候再指定类型。</p> <p>泛型中的 <code>T</code> 就像一个占位符、或者说一个变量，在使用的时候可以把定义的类型像参数一样传入，它可以原封不动地输出。</p> <p>用一张图来总结一下泛型的好处：</p> <p><img src="https://raw.githubusercontent.com/asasugar/pic-bed/master/imgs/20220328173835.png" alt="20220328173835"></p> <h3 id="高级类型（二）"><a href="#高级类型（二）" class="header-anchor">#</a> 高级类型（二）</h3> <blockquote><p>索引类型</p></blockquote> <p>从对象中抽取一些属性的值，然后拼接成数组，可以这么写，</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'Sugar'</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token string">'24'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getValues</span><span class="token punctuation">(</span>userInfo<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> keys<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> keys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> userInfo<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 抽取指定属性的值</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getValues</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ['Sugar', '24']</span>
<span class="token comment">// 抽取obj中没有的属性:</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getValues</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'sex'</span><span class="token punctuation">,</span> <span class="token string">'outlook'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [undefined, undefined]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>虽然 <code>obj</code> 中并不包含 <code>sex</code> 和 <code>outlook</code> 属性,但 TS 编译器并未报错</p> <p>此时使用 TS 索引类型,对这种情况做类型约束，实现动态属性的检查。</p> <p>理解索引类型，需先理解 <code>keyof</code>（索引查询）、<code>T[K]</code>（索引访问） 和 <code>extends</code> (泛型约束)。</p> <h4 id="keyof（索引查询）"><a href="#keyof（索引查询）" class="header-anchor">#</a> keyof（索引查询）</h4> <p><code>keyof</code> 操作符可以用于获取某种类型的所有键，其返回类型是联合类型。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">IPerson</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">Key</span> <span class="token operator">=</span> <span class="token keyword">keyof</span> IPerson<span class="token punctuation">;</span> <span class="token comment">// 'name' | 'age'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>上面的例子，<code>Key</code> 类型变成了一个 <code>字符串字面量</code>。</p> <h4 id="t-k-（索引访问）"><a href="#t-k-（索引访问）" class="header-anchor">#</a> T[K]（索引访问）</h4> <p><code>T[K]</code>，表示接口 <code>T</code> 的属性 <code>K</code> 所代表的类型，</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">IPerson</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> type1<span class="token operator">:</span> IPerson<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// string</span>
<span class="token keyword">let</span> type2<span class="token operator">:</span> IPerson<span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// number</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="extends-泛型约束"><a href="#extends-泛型约束" class="header-anchor">#</a> extends (泛型约束)</h4> <p><code>T extends U</code>，表示泛型变量可以通过继承某个类型，获得某些属性，之前讲过，复习一下，</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">ILength</span> <span class="token punctuation">{</span>
  length<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">printLength</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> ILength<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> arg<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="检查动态属性"><a href="#检查动态属性" class="header-anchor">#</a> 检查动态属性</h4> <p>对索引类型的几个概念了解后,对 getValue 函数进行改造，实现对象上动态属性的检查。</p> <p>改造前:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'Sugar'</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token string">'24'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getValues</span><span class="token punctuation">(</span>userInfo<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> keys<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> keys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> userInfo<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li><p>定义泛型 <code>T</code>、 <code>K</code> ，用于约束 <code>userInfo</code> 和 <code>keys</code></p></li> <li><p>为 <code>K</code> 增加一个泛型约束，使 <code>K</code> 继承 <code>userInfo</code> 的所有属性的联合类型, 即 <code>K extends keyof T</code></p></li></ul> <p>改造后：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">getValues</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>userInfo<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> keys<span class="token operator">:</span> <span class="token constant">K</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> keys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> userInfo<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这样当我们指定不在对象里的属性时，就会报错，</p> <p><img src="https://raw.githubusercontent.com/asasugar/pic-bed/master/imgs/20220328175321.png" alt="20220328175321"></p> <blockquote><p>映射类型</p></blockquote> <p>TS 允许将一个类型映射成另外一个类型。</p> <h4 id="in"><a href="#in" class="header-anchor">#</a> in</h4> <p>介绍映射类型之前，先介绍一下 <code>in</code> 操作符，用来对联合类型实现遍历。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">Person</span> <span class="token operator">=</span> <span class="token string">'name'</span> <span class="token operator">|</span> <span class="token string">'school'</span> <span class="token operator">|</span> <span class="token string">'major'</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Obj</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>p <span class="token keyword">in</span> Person<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="partial"><a href="#partial" class="header-anchor">#</a> Partial</h4> <p><code>Partial&lt;T&gt;</code> 将 <code>T</code> 的所有属性映射为<code>可选</code>的，例如：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">IPerson</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> p1<span class="token operator">:</span> IPerson <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'Sugar'</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>使用了 <code>IPerson</code> 接口，就一定要传 <code>name</code> 和 <code>age</code> 属性，</p> <p><img src="https://raw.githubusercontent.com/asasugar/pic-bed/master/imgs/20220328175707.png" alt="20220328175707"></p> <p>使用 <code>Partial</code> 改造一下，就可以变成可选属性，</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">IPerson</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">IPartial</span> <span class="token operator">=</span> Partial<span class="token operator">&lt;</span>IPerson<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> p1<span class="token operator">:</span> IPartial <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="partial-原理"><a href="#partial-原理" class="header-anchor">#</a> Partial 原理</h4> <p><code>Partial</code> 的实现用到了 <code>in</code> 和 <code>keyof</code></p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">/**
 * Make all properties in T optional
 */</span>
<span class="token keyword">type</span> <span class="token class-name">Partial<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><code>[P in keyof T]</code> 遍历 <code>T</code> 上的所有属性</li> <li><code>?:</code> 设置属性为可选的</li> <li><code>T[P]</code> 设置类型为原来的类型</li></ul> <h4 id="readonly"><a href="#readonly" class="header-anchor">#</a> Readonly</h4> <p><code>Readonly&lt;T&gt;</code> 将 <code>T</code> 的所有属性映射为 <code>只读</code> 的，例如：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">IPerson</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">IReadOnly</span> <span class="token operator">=</span> Readonly<span class="token operator">&lt;</span>IPerson<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> p1<span class="token operator">:</span> IReadOnly <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'Sugar'</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><img src="https://raw.githubusercontent.com/asasugar/pic-bed/master/imgs/20220328180130.png" alt="20220328180130"></p> <h4 id="readonly-原理"><a href="#readonly-原理" class="header-anchor">#</a> Readonly 原理</h4> <p>和 <code>Partial</code> 几乎完全一样，</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">/**
 * Make all properties in T readonly
 */</span>
<span class="token keyword">type</span> <span class="token class-name">Readonly<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><code>[P in keyof T]</code> 遍历 <code>T</code> 上的所有属性</li> <li><code>readonly</code> 设置属性为可读的</li> <li><code>T[P]</code> 设置类型为原来的类型</li></ul> <h4 id="pick"><a href="#pick" class="header-anchor">#</a> Pick</h4> <p><code>Pick</code> 用于抽取对象子集，挑选一组属性并组成一个新的类型，例如：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">IPerson</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  sex<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">IPick</span> <span class="token operator">=</span> Pick<span class="token operator">&lt;</span>IPerson<span class="token punctuation">,</span> <span class="token string">'name'</span> <span class="token operator">|</span> <span class="token string">'age'</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> p1<span class="token operator">:</span> IPick <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'Sugar'</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="pick-原理"><a href="#pick-原理" class="header-anchor">#</a> Pick 原理</h4> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">/**
 * From T, pick a set of properties whose keys are in the union K
 */</span>
<span class="token keyword">type</span> <span class="token class-name">Pick<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Pick 映射类型有两个参数:</p> <ul><li>第一个参数 <code>T</code> ，表示要抽取的目标对象</li> <li>第二个参数 <code>K</code> ，具有一个约束：K 一定要来自 T 所有属性字面量的联合类型</li></ul> <h4 id="record"><a href="#record" class="header-anchor">#</a> Record</h4> <p>上面三种映射类型官方称为 <code>同态</code> ,意思是只作用于 <code>obj</code> 属性而不会引入新的属性。</p> <p><code>Record</code> 是会创建新属性的 <code>非同态</code> 映射类型。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">IPerson</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">IRecord</span> <span class="token operator">=</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> IPerson<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> personMap<span class="token operator">:</span> IRecord <span class="token operator">=</span> <span class="token punctuation">{</span>
  person1<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Sugar'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  person2<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Xue'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="record-原理"><a href="#record-原理" class="header-anchor">#</a> Record 原理</h4> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">/**
 * Construct a type with a set of properties K of type T
 */</span>
<span class="token keyword">type</span> <span class="token class-name">Record<span class="token operator">&lt;</span><span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Record 映射类型有两个参数:</p> <ul><li>第一个参数可以传入继承于 any 的任何值</li> <li>第二个参数，作为新创建对象的值，被传入。</li></ul> <blockquote><p>条件类型</p></blockquote> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token constant">U</span></span> <span class="token operator">?</span> <span class="token constant">X</span> <span class="token operator">:</span> <span class="token constant">Y</span>
<span class="token comment">// 若类型 T 可被赋值给类型 U,那么结果类型就是 X 类型,否则就是 Y 类型</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>Exclude</code> 和 <code>Extract</code> 的实现就用到了条件类型。</p> <h4 id="exclude"><a href="#exclude" class="header-anchor">#</a> Exclude</h4> <p><code>Exclude</code> 意思是不包含，<code>Exclude&lt;T, U&gt;</code> 会返回 <code>联合类型 T</code> 和 <code>联合类型 U</code> 不相交的部分。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">Test</span> <span class="token operator">=</span> Exclude<span class="token operator">&lt;</span><span class="token string">'a'</span> <span class="token operator">|</span> <span class="token string">'b'</span> <span class="token operator">|</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://raw.githubusercontent.com/asasugar/pic-bed/master/imgs/20220328181452.png" alt="20220328181452"></p> <h4 id="exclude-原理"><a href="#exclude-原理" class="header-anchor">#</a> Exclude 原理</h4> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">/**
 * Exclude from T those types that are assignable to U
 */</span>
<span class="token keyword">type</span> <span class="token class-name">Exclude<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token constant">U</span></span> <span class="token operator">?</span> <span class="token builtin">never</span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>never</code> 表示一个不存在的类型</li> <li>never 与其他类型的 <code>联合</code> 后，为 <code>其他类型</code></li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">Test</span> <span class="token operator">=</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://raw.githubusercontent.com/asasugar/pic-bed/master/imgs/20220328181654.png" alt="20220328181654"></p> <h4 id="extract"><a href="#extract" class="header-anchor">#</a> Extract</h4> <p><code>Extract&lt;T, U&gt;</code> 提取联合类型 <code>T</code> 和联合类型 <code>U</code> 的所有交集。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">Test</span> <span class="token operator">=</span> Extract<span class="token operator">&lt;</span><span class="token string">'key1'</span> <span class="token operator">|</span> <span class="token string">'key2'</span><span class="token punctuation">,</span> <span class="token string">'key1'</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://raw.githubusercontent.com/asasugar/pic-bed/master/imgs/20220329134250.png" alt="20220329134250"></p> <h4 id="extract-原理"><a href="#extract-原理" class="header-anchor">#</a> Extract 原理</h4> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">/**
 * Extract from T those types that are assignable to U
 */</span>
<span class="token keyword">type</span> <span class="token class-name">Extract<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token constant">U</span></span> <span class="token operator">?</span> <span class="token constant">T</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>工具类型（Utility Types）</p></blockquote> <p>为了方便开发者使用， TypeScript 内置了一些常用的工具类型。</p> <p>上文介绍的<code>索引类型</code>、<code>映射类型</code>和<code>条件类型</code>都是工具类型。</p> <p>除了上文介绍的，再介绍一些常用的，毕竟工具函数遇到了去查就行，死记硬背就太枯燥了，熟能生巧，写多了自然就熟悉了。</p> <h4 id="omit"><a href="#omit" class="header-anchor">#</a> Omit</h4> <p><code>Omit&lt;T, U&gt;</code>从类型 <code>T</code> 中剔除 <code>U</code> 中的所有属性。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">IPerson</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">IOmit</span> <span class="token operator">=</span> Omit<span class="token operator">&lt;</span>IPerson<span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="https://raw.githubusercontent.com/asasugar/pic-bed/master/imgs/20220329134611.png" alt="20220329134611"></p> <h4 id="omit-原理"><a href="#omit-原理" class="header-anchor">#</a> Omit 原理</h4> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">/**
 * Construct a type with the properties of T except for those in type K.
 */</span>
<span class="token keyword">type</span> <span class="token class-name">Omit<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> Pick<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> Exclude<span class="token operator">&lt;</span><span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>Pick</code> 用于挑选一组属性并组成一个新的类型，<code>Omit</code> 是剔除一些属性，留下剩余的，他们俩有点相反的感觉。</p> <p>那么就可以用 <code>Pick 和 Exclude</code> 实现 Omit。</p> <p>当然也可以不用 <code>Pick</code> 实现，</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">Omit2<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> Exclude<span class="token operator">&lt;</span><span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="nonnullable"><a href="#nonnullable" class="header-anchor">#</a> NonNullable</h4> <p><code>NonNullable&lt;T&gt;</code> 用来过滤类型中的 <code>null</code> 及 <code>undefined</code> 类型。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T0</span></span> <span class="token operator">=</span> NonNullable<span class="token operator">&lt;</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// string | number</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T1</span></span> <span class="token operator">=</span> NonNullable<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// string[]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="nonnullable-原理"><a href="#nonnullable-原理" class="header-anchor">#</a> NonNullable 原理</h4> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">/**
 * Exclude null and undefined from T
 */</span>
<span class="token keyword">type</span> <span class="token class-name">NonNullable<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token keyword">null</span></span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token builtin">never</span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="awaited"><a href="#awaited" class="header-anchor">#</a> Awaited</h4> <p><code>Awaited&lt;T&gt;</code>：作用是获取 <code>async/await</code> 函数或 <code>promise</code> 的 <code>then()</code> 方法的返回值的类型。而且自带递归效果，如果是这样嵌套的异步方法，也能拿到最终的返回值类型</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// Promise</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T1</span></span> <span class="token operator">=</span> Awaited<span class="token operator">&lt;</span><span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// type T1 = string</span>

<span class="token comment">// 嵌套 Promise，会递归</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T2</span></span> <span class="token operator">=</span> Awaited<span class="token operator">&lt;</span><span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;&gt;&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// type T2 = number</span>

<span class="token comment">// 联合类型，会触发分发</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T3</span></span> <span class="token operator">=</span> Awaited<span class="token operator">&lt;</span><span class="token builtin">boolean</span> <span class="token operator">|</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// type T3 = number | boolean</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="awaited-原理"><a href="#awaited-原理" class="header-anchor">#</a> Awaited 原理</h4> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">/**
 * Recursively unwraps the &quot;awaited type&quot; of a type. Non-promise &quot;thenables&quot; should resolve to `never`. This emulates the behavior of `await`.
 */</span>
<span class="token keyword">type</span> <span class="token class-name">Awaited<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token keyword">null</span></span> <span class="token operator">|</span> <span class="token keyword">undefined</span>
  <span class="token operator">?</span> <span class="token constant">T</span> <span class="token comment">// special case for `null | undefined` when not in `--strictNullChecks` mode</span>
  <span class="token operator">:</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">object</span> <span class="token operator">&amp;</span> <span class="token punctuation">{</span> <span class="token function">then</span><span class="token punctuation">(</span>onfulfilled<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">F</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> <span class="token keyword">infer</span> _<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span> <span class="token comment">// `await` only unwraps object types with a callable `then`. Non-object types are not unwrapped</span>
  <span class="token operator">?</span> <span class="token constant">F</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">V</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> <span class="token keyword">infer</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">any</span> <span class="token comment">// if the argument to `then` is callable, extracts the first argument</span>
    <span class="token operator">?</span> Awaited<span class="token operator">&lt;</span><span class="token constant">V</span><span class="token operator">&gt;</span> <span class="token comment">// recursively unwrap the value</span>
    <span class="token operator">:</span> <span class="token builtin">never</span> <span class="token comment">// the argument to `then` was not callable</span>
  <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span> <span class="token comment">// non-object or non-thenable</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol><li><p>如果 T 是 null 或 undefined 就直接返回 T</p></li> <li><p>如果 T 是对象类型，并且里面有 then 方法，就用 infer 类型推断出 then 方法的第一个参数 onfulfilled 的类型赋值给 F，onfulfilled 其实就是我们熟悉的 resolve。所以这里可以看出或者准确的说，Awaited 拿的不是 then() 的返回值类型，而是 resolve() 的返回值类型</p> <ul><li>既然 F 是回调函数 resolve ，就推断出该函数第一个参数类型赋值给 V ，resolve 的参数自然就是返回值
<ul><li>传入 V 递归调用</li></ul></li> <li>F 不是函数就返回 never</li></ul></li> <li><p>如果 T 不是对象类型 或者 是对象但没有 then 方法，返回 T ，就是最后一行的 T</p></li></ol> <h4 id="parameters"><a href="#parameters" class="header-anchor">#</a> Parameters</h4> <p><code>Parameters</code> 获取函数的参数类型，将每个参数类型放在一个元组中。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T1</span></span> <span class="token operator">=</span> Parameters<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">string</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// []</span>

<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T2</span></span> <span class="token operator">=</span> Parameters<span class="token operator">&lt;</span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// [string]</span>

<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T3</span></span> <span class="token operator">=</span> Parameters<span class="token operator">&lt;</span><span class="token punctuation">(</span>arg1<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> arg2<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// [arg1: string, arg2: number]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="parameters-原理"><a href="#parameters-原理" class="header-anchor">#</a> Parameters 原理</h4> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">/**
 * Obtain the parameters of a function type in a tuple
 */</span>
<span class="token keyword">type</span> <span class="token class-name">Parameters<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span> <span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span>
  <span class="token operator">...</span>args<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">P</span>
<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">any</span>
  <span class="token operator">?</span> <span class="token constant">P</span>
  <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在条件类型语句中，可以用 <code>infer</code> 声明一个类型变量并且对它进行使用。</p> <ul><li><code>Parameters</code> 首先约束参数 <code>T</code> 必须是个函数类型</li> <li>判断 <code>T</code> 是否是函数类型，如果是则使用 <code>infer P</code> 暂时存一下函数的参数类型，后面的语句直接用 <code>P</code> 即可得到这个类型并返回，否则就返回 <code>never</code></li></ul> <h4 id="returntype"><a href="#returntype" class="header-anchor">#</a> ReturnType</h4> <p><code>ReturnType</code> 获取函数的返回值类型。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T0</span></span> <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">string</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// string</span>

<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T1</span></span> <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token punctuation">(</span>s<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// void</span>

<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T2</span></span> <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token punctuation">(</span>s<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">;</span> <span class="token comment">// Promise&lt;string&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="returntype-原理"><a href="#returntype-原理" class="header-anchor">#</a> ReturnType 原理</h4> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">/**
 * Obtain the return type of a function type
 */</span>
<span class="token keyword">type</span> <span class="token class-name">ReturnType<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span> <span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span>
  <span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span>
<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">infer</span> <span class="token constant">R</span>
  <span class="token operator">?</span> <span class="token constant">R</span>
  <span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>懂了 <code>Parameters</code>，也就懂了 <code>ReturnType</code>，</p> <ul><li><code>ReturnType</code> 首先约束参数 <code>T</code> 必须是个函数类型</li> <li>判断 <code>T</code> 是否是函数类型，如果是则使用 <code>infer R</code> 暂时存一下函数的返回值类型，后面的语句直接用 <code>R</code> 即可得到这个类型并返回，否则就返回 <code>any</code></li></ul> <h4 id="constructorparameters-instancetype"><a href="#constructorparameters-instancetype" class="header-anchor">#</a> ConstructorParameters/InstanceType</h4> <p>我们知道 <code>Parameters</code> 和 <code>ReturnType</code> 这一对是获取普通/箭头函数的参数类型集合以及返回值类型的了，还有一对组合 <code>ConstructorParameters</code> 和 <code>InstanceType</code> 是获取构造函数的参数类型集合以及返回值类型的，和上面的比较类似</p> <h4 id="uppercase-lowercase"><a href="#uppercase-lowercase" class="header-anchor">#</a> Uppercase/Lowercase</h4> <p>转换全部字母大小写</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T1</span></span> <span class="token operator">=</span> Uppercase<span class="token operator">&lt;</span><span class="token string">'abcd'</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// type T1 = &quot;ABCD&quot;</span>

<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T2</span></span> <span class="token operator">=</span> Lowercase<span class="token operator">&lt;</span><span class="token string">'ABCD'</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// type T2 = &quot;abcd&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="capitalize-uncapitalize"><a href="#capitalize-uncapitalize" class="header-anchor">#</a> Capitalize/Uncapitalize</h4> <p>转换首字母大小写</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T1</span></span> <span class="token operator">=</span> Capitalize<span class="token operator">&lt;</span><span class="token string">'abcd'</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// type T1 = &quot;Abcd&quot;</span>

<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T2</span></span> <span class="token operator">=</span> Uncapitalize<span class="token operator">&lt;</span><span class="token string">'ABCD'</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// type T2 = &quot;aBCD&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>类型体操是什么？</p></blockquote> <p>在本节中，我们熟悉了很多工具类型的作用和原理，其实已经在不知不觉中做了一些 <code>类型体操</code> 了</p> <p>TypeScript 高级类型会根据类型参数求出新的类型，这个过程会涉及一系列的类型计算逻辑，这些类型计算逻辑就叫做类型体操。当然，这并不是一个正式的概念，只是社区的戏称，因为有的类型计算逻辑是比较复杂的。</p> <p>想一想我们之前研究的这些工具类型，都是在对类型做计算返回新的类型啊。</p> <p>Ts 是一门图灵完备的编程语言，即类型的可编码化，可以通过代码逻辑生成指定的各种类型，基于这点，才会有各种类型体操。</p> <h3 id="ts-声明文件"><a href="#ts-声明文件" class="header-anchor">#</a> TS 声明文件</h3> <blockquote><p>declare</p></blockquote> <p>当使用第三方库时，很多三方库不是用 TS 写的，我们需要引用它的声明文件，才能获得对应的代码补全、接口提示等功能。</p> <p>比如，在 TS 中直接使用 Vue，就会报错，</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    message<span class="token operator">:</span> <span class="token string">'Hello Vue!'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="https://raw.githubusercontent.com/asasugar/pic-bed/master/imgs/20220329140556.png" alt="20220329140556"></p> <p>这时，我们可以使用 declare 关键字来定义 Vue 的类型，简单写一个模拟一下，</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">VueOption</span> <span class="token punctuation">{</span>
  el<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  data<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">declare</span> <span class="token keyword">class</span> <span class="token class-name">Vue</span> <span class="token punctuation">{</span>
  options<span class="token operator">:</span> VueOption<span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>options<span class="token operator">:</span> VueOption<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    message<span class="token operator">:</span> <span class="token string">'Hello Vue!'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>这样就不会报错了，使用 <code>declare</code> 关键字，相当于告诉 TS 编译器，这个变量（Vue）的类型已经在其他地方定义了，你直接拿去用，别报错。</p> <p>需要注意的是，<code>declare class Vue</code> 并没有真的定义一个类，只是定义了类 Vue 的 <code>类型</code> ，仅仅会用于 <code>编译时</code> 的检查，在编译结果中会被删除。它编译结果不变。</p> <blockquote><p>.d.ts 声明文件</p></blockquote> <p>通常我们会把声明语句放到一个单独的文件（<code>evn.d.ts</code>）中，这就是声明文件，以 <code>.d.ts</code> 为后缀。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// src/evn.d.ts</span>
<span class="token comment">/// &lt;reference types=&quot;vite/client&quot; /&gt;</span>

<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'*.vue'</span> <span class="token punctuation">{</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> DefineComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
  <span class="token comment">// eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/ban-types</span>
  <span class="token keyword">const</span> component<span class="token operator">:</span> DefineComponent<span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> component<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'qs'</span><span class="token punctuation">;</span>

<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'mockjs'</span><span class="token punctuation">;</span>

<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'*.json'</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>一般来说，<code>ts</code> 会解析项目中所有的 <code>*.ts</code> 文件，当然也包含以 <code>.d.ts</code> 结尾的文件。所以当我们将 <code>evn.d.ts</code> 放到项目中时，其他所有 <code>*.ts</code> 文件就都可以获得类型定义了。</p> <blockquote><p>使用三方库</p></blockquote> <p>那么当我们使用三方库的时候，是不是所有的三方库都要写一大堆 decare 的文件呢？</p> <p>答案是不一定，要看社区里有没有这个三方库的 TS 类型包（一般都有）。</p> <p>社区使用 <code>@types</code> 统一管理第三方库的声明文件，是由 <code>DefinitelyTyped</code> 这个组织统一管理的</p> <p>比如安装 <code>lodash</code> 的类型包</p> <div class="language-bish line-numbers-mode"><pre class="language-text"><code>pnpm add @types/lodash -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>当然，如果一个库本来就是 TS 写的，就不用担心类型文件的问题，比如 <code>Vue3</code>。</p> <blockquote><p>自己写声明文件</p></blockquote> <p>比如你以前写了一个请求小模块 <code>myFetch</code>，代码如下，</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">myFetch</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> method<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">body</span><span class="token operator">:</span> data <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    method<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

myFetch<span class="token punctuation">.</span><span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">myFetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">'GET'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

myFetch<span class="token punctuation">.</span><span class="token function-variable function">post</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">myFetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> myFetch<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>现在新项目用了 <code>TS</code> 了，要在新项目中继续用这个 <code>myFetch</code>，你有两种选择：</p> <ul><li>用 <code>TS 重写</code> myFetch，新项目引重写的 <code>myFetch</code>[<strong>推荐</strong>]</li> <li>直接引 <code>myFetch</code> ，给它写 <code>声明文件</code></li></ul> <p>如果选择第二种方案，就可以这么做，</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">HTTPMethod</span> <span class="token operator">=</span> <span class="token string">'GET'</span> <span class="token operator">|</span> <span class="token string">'POST'</span> <span class="token operator">|</span> <span class="token string">'PUT'</span> <span class="token operator">|</span> <span class="token string">'DELETE'</span><span class="token punctuation">;</span>

<span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">myFetch</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  method<span class="token operator">:</span> HTTPMethod<span class="token punctuation">,</span>
  data<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">declare</span> <span class="token keyword">namespace</span> myFetch <span class="token punctuation">{</span>
  <span class="token comment">// 使用 namespace 来声明对象下的属性和方法</span>
  <span class="token keyword">const</span> get<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> post<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> data<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>比较麻烦的是需要配置才行，可以有两种选择，</p> <p>1.创建一个 <code>node_modules/@types/myFetch/index.d.ts</code> 文件，存放 <code>myFetch</code> 模块的声明文件。这种方式不需要额外的配置</p> <p>2.创建一个 <code>types</code> 目录，专门用来管理自己写的声明文件，将 <code>myFetch</code> 的声明文件放到 <code>types/myFetch/index.d.ts</code> 中[<strong>推荐</strong>]</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// tsconfig.json</span>
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;commonjs&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;baseUrl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;paths&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;*&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;types/*&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>直接用 TS 重写比给老项目写声明文件更好，这样就不用专门维护类型模块了。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/asasugar/Blog/edit/master/docs/ts/ts-II.md" target="_blank" rel="noopener noreferrer">帮助我改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">1/5/2023, 3:33:08 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/ts/ts-I.html" class="prev">
        通俗易懂的 TS 教程（上）
      </a></span> <span class="next"><a href="/ts/ts-III.html">
        通俗易懂的 TS 教程（下）
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.98369610.js" defer></script><script src="/assets/js/2.dae98aab.js" defer></script><script src="/assets/js/40.7007eded.js" defer></script>
  </body>
</html>
